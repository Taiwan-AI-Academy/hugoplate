<!-- theme switcher -->
{{ $class := .Class }}
{{ if site.Params.theme_switcher }}
  <button
    class="theme-switcher {{ $class }} invisible"
    type="button"
    data-theme-switcher
    aria-label="切換深色模式"
    aria-pressed="false">
    <svg viewBox="0 0 24 24" fill="none" height="18" width="18" aria-hidden="true">
      <path
        fill="currentColor"
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M8.2 2.2c1-.4 2 .6 1.6 1.5-1 3-.4 6.4 1.8 8.7a8.4 8.4 0 0 0 8.7 1.8c1-.3 2 .5 1.5 1.5v.1a10.3 10.3 0 0 1-9.4 6.2A10.3 10.3 0 0 1 3.2 6.7c1-2 2.9-3.5 4.9-4.4Z" />
    </svg>
  </button>

  <!-- theme switcher -->
  <script>
    (function () {
      var switcher = document.querySelector("[data-theme-switcher]");
      if (!switcher) return;

      var darkMode = localStorage.getItem("theme") === "dark";

      if (localStorage.getItem("theme") === null) {
        darkMode = {{ if eq site.Params.theme_default "dark" }}true{{ else }}false{{ end }};
        {{ if eq site.Params.theme_default "system" }}
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          darkMode = true;
        }
        {{ end }}
      }

      function applyTheme() {
        if (darkMode) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
        switcher.setAttribute("aria-pressed", darkMode ? "true" : "false");
      }

      applyTheme();
      switcher.classList.remove("invisible");

      switcher.addEventListener("click", function () {
        darkMode = !darkMode;
        applyTheme();
        localStorage.setItem("theme", darkMode ? "dark" : "light");
      });
    })();
  </script>
{{ end }}
